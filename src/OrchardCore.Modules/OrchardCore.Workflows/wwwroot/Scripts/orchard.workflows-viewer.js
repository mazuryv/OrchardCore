/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas =
/** @class */
function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;

    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;

    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };

    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };

    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };

    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };

    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);

      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };

    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }

      if (!activities) {
        activities = this.workflowType.activities;
      }

      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };

    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id; // Connect activities.

      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };

    this.updateCanvasHeight = function () {
      var $container = $(this.container); // Get the activity element with the highest Y coordinate.

      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;

      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;

        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }

      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;

      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }

      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }

  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) {
        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
      }
    };

    return _extendStatics(d, b);
  };

  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");

    _extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var WorkflowViewer =
/** @class */
function (_super) {
  __extends(WorkflowViewer, _super);

  function WorkflowViewer(container, workflowType) {
    var _this = _super.call(this, container, workflowType) || this;

    _this.container = container;
    _this.workflowType = workflowType;

    _this.getEndpointColor = function (activity) {
      return activity.isBlocking ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };

    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());

      var plumber = _this.createJsPlumbInstance(); // Listen for new connections.


      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });

      var activityElements = _this.getActivityElements();

      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }

        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];

          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }

        return true;
      }; // Suspend drawing and initialize.


      plumber.batch(function () {
        var workflowId = _this.workflowType.id;
        activityElements.each(function (index, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');

          var activity = _this.getActivity(activityId); // Configure the activity as a target.


          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          }); // Add source endpoints.

          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];

            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);

            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        }); // Connect activities.

        _this.updateConnections(plumber); // Re-query the activity elements.


        activityElements = _this.getActivityElements(); // Make all activity elements visible.

        activityElements.show();

        _this.updateCanvasHeight();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }

  return WorkflowViewer;
}(WorkflowCanvas);

$.fn.workflowViewer = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    $element.data('workflowViewer', new WorkflowViewer(element, workflowType));
  });
  return this;
};

$(document).ready(function () {
  var workflowViewer = $('.workflow-canvas').workflowViewer().data('workflowViewer');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmtmbG93LWNhbnZhcy50cyIsIndvcmtmbG93LXZpZXdlci50cyIsIndvcmtmbG93LXZpZXdlci5qcyJdLCJuYW1lcyI6WyJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsIiQiLCJmaW5kIiwiZ2V0RGVmYXVsdHMiLCJBbmNob3IiLCJEcmFnT3B0aW9ucyIsImN1cnNvciIsInpJbmRleCIsIkVuZHBvaW50U3R5bGVzIiwiZmlsbFN0eWxlIiwiRW5kcG9pbnRzIiwicmFkaXVzIiwiQ29ubmVjdGlvbk92ZXJsYXlzIiwid2lkdGgiLCJsZW5ndGgiLCJsb2NhdGlvbiIsIkNvbm5lY3RvclpJbmRleCIsImNyZWF0ZUpzUGx1bWJJbnN0YW5jZSIsImpzUGx1bWIiLCJnZXRJbnN0YW5jZSIsInZpc2libGUiLCJpZCIsImNzc0NsYXNzIiwiQ29udGFpbmVyIiwiZ2V0RW5kcG9pbnRDb2xvciIsImFjdGl2aXR5IiwiaXNCbG9ja2luZyIsImlzU3RhcnQiLCJpc0V2ZW50IiwiZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zIiwib3V0Y29tZSIsInBhaW50Q29sb3IiLCJlbmRwb2ludCIsImFuY2hvciIsInBhaW50U3R5bGUiLCJzdHJva2UiLCJmaWxsIiwic3Ryb2tlV2lkdGgiLCJpc1NvdXJjZSIsImNvbm5lY3RvciIsInN0dWIiLCJnYXAiLCJjb3JuZXJSYWRpdXMiLCJhbHdheXNSZXNwZWN0U3R1YnMiLCJjb25uZWN0b3JTdHlsZSIsImpvaW5zdHlsZSIsIm91dGxpbmVTdHJva2UiLCJvdXRsaW5lV2lkdGgiLCJob3ZlclBhaW50U3R5bGUiLCJjb25uZWN0b3JIb3ZlclN0eWxlIiwiY29ubmVjdG9yT3ZlcmxheXMiLCJkcmFnT3B0aW9ucyIsInV1aWQiLCJjb25jYXQiLCJuYW1lIiwicGFyYW1ldGVycyIsImdldEFjdGl2aXR5IiwiYWN0aXZpdGllcyIsImdyZXAiLCJ4IiwidXBkYXRlQ29ubmVjdGlvbnMiLCJwbHVtYmVyIiwid29ya2Zsb3dJZCIsIl9pIiwiX2EiLCJ0cmFuc2l0aW9ucyIsInRyYW5zaXRpb25Nb2RlbCIsInNvdXJjZUVuZHBvaW50VXVpZCIsInNvdXJjZUFjdGl2aXR5SWQiLCJzb3VyY2VPdXRjb21lTmFtZSIsInNvdXJjZUVuZHBvaW50IiwiZ2V0RW5kcG9pbnQiLCJkZXN0aW5hdGlvbkVsZW1lbnRJZCIsImRlc3RpbmF0aW9uQWN0aXZpdHlJZCIsImNvbm5lY3QiLCJzb3VyY2UiLCJ0YXJnZXQiLCJ1cGRhdGVDYW52YXNIZWlnaHQiLCIkY29udGFpbmVyIiwiJGFjdGl2aXR5RWxlbWVudHMiLCJjdXJyZW50RWxlbWVudFRvcCIsImN1cnJlbnRBY3Rpdml0eUhlaWdodCIsInRvQXJyYXkiLCJhY3Rpdml0eUVsZW1lbnQiLCIkYWN0aXZpdHlFbGVtZW50IiwidG9wXzEiLCJwb3NpdGlvbiIsInRvcCIsImhlaWdodCIsIm5ld0NhbnZhc0hlaWdodCIsImVsZW1lbnRCb3R0b20iLCJzdHJldGNoVmFsdWUiLCJNYXRoIiwibWF4IiwiX19leHRlbmRzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwiT2JqZWN0Iiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJUeXBlRXJyb3IiLCJTdHJpbmciLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiV29ya2Zsb3dWaWV3ZXIiLCJfc3VwZXIiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJjb25uZWN0aW9uIiwiZ2V0UGFyYW1ldGVycyIsImxhYmVsIiwiZ2V0T3ZlcmxheSIsInNldExhYmVsIiwiZGlzcGxheU5hbWUiLCJhY3Rpdml0eUVsZW1lbnRzIiwiYXJlRXF1YWxPdXRjb21lcyIsIm91dGNvbWVzMSIsIm91dGNvbWVzMiIsImkiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJlYWNoIiwiaW5kZXgiLCJhY3Rpdml0eUlkIiwiZGF0YSIsIm1ha2VUYXJnZXQiLCJkcm9wT3B0aW9ucyIsImhvdmVyQ2xhc3MiLCJvdXRjb21lcyIsInNvdXJjZUVuZHBvaW50T3B0aW9ucyIsImFkZEVuZHBvaW50Iiwic2hvdyIsImpzUGx1bWJJbnN0YW5jZSIsImZuIiwid29ya2Zsb3dWaWV3ZXIiLCJlbGVtZW50IiwiJGVsZW1lbnQiLCJkb2N1bWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFFQSxJQUFBQSxjQUFBO0FBQUE7QUFBQSxZQUFBO0VBR0ksU0FBQUEsY0FBQSxDQUFzQkMsU0FBdEIsRUFBd0RDLFlBQXhELEVBQTRGO0lBQTVGLElBQUFDLEtBQUEsR0FBQSxJQUFBOztJQUFzQixLQUFBRixTQUFBLEdBQUFBLFNBQUE7SUFBa0MsS0FBQUMsWUFBQSxHQUFBQSxZQUFBO0lBRmhELEtBQUFFLGVBQUEsR0FBMEIsR0FBMUI7O0lBS0UsS0FBQUMsbUJBQUEsR0FBc0IsWUFBQTtNQUM1QixPQUFPQyxDQUFDLENBQUNILEtBQUksQ0FBQ0YsU0FBTixDQUFELENBQWtCTSxJQUFsQixDQUF1QixXQUF2QixDQUFQO0lBQ0gsQ0FGUzs7SUFJQSxLQUFBQyxXQUFBLEdBQWMsWUFBQTtNQUNwQixPQUFPO1FBQ0hDLE1BQU0sRUFBRSxZQURMO1FBRUhDLFdBQVcsRUFBRTtVQUFFQyxNQUFNLEVBQUUsU0FBVjtVQUFxQkMsTUFBTSxFQUFFO1FBQTdCLENBRlY7UUFHSEMsY0FBYyxFQUFFLENBQUM7VUFBRUMsU0FBUyxFQUFFO1FBQWIsQ0FBRCxDQUhiO1FBSUhDLFNBQVMsRUFBRSxDQUFDLENBQUMsS0FBRCxFQUFRO1VBQUVDLE1BQU0sRUFBRTtRQUFWLENBQVIsQ0FBRCxFQUF5QixDQUFDLE9BQUQsQ0FBekIsQ0FKUjtRQUtIQyxrQkFBa0IsRUFBRSxDQUNoQixDQUFDLE9BQUQsRUFBVTtVQUFFQyxLQUFL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LE9BQXZCLEVBdkJVLENBeUJWOzs7UUFDQWdFLGdCQUFnQixHQUFHL0gsS0FBSSxDQUFDRSxtQkFBTCxFQUFuQixDQTFCVSxDQTRCVjs7UUFDQTZILGdCQUFnQixDQUFDa0IsSUFBakI7O1FBRUFqSixLQUFJLENBQUMrRSxrQkFBTDtNQUNILENBaENEO01Ba0NBL0UsS0FBSSxDQUFDa0osZUFBTCxHQUF1Qm5GLE9BQXZCO0lBQ0gsQ0FyRUQ7SUN1RUEsT0FBTy9ELEtBQVA7RURESDs7RUFLTCxPQUFBaUgsY0FBQTtBQWxGQSxDQUFBLENBQTZCcEgsY0FBN0IsQ0FBQTs7QUFvRkFNLENBQUMsQ0FBQ2dKLEVBQUYsQ0FBS0MsY0FBTCxHQUFzQixZQUFBO0VBQ2xCLEtBQUtiLElBQUwsQ0FBVSxVQUFDQyxLQUFELEVBQVFhLE9BQVIsRUFBZTtJQUNyQixJQUFJQyxRQUFRLEdBQUduSixDQUFDLENBQUNrSixPQUFELENBQWhCO0lBQ0EsSUFBSXRKLFlBQVksR0FBMkJ1SixRQUFRLENBQUNaLElBQVQsQ0FBYyxlQUFkLENBQTNDO0lBRUFZLFFBQVEsQ0FBQ1osSUFBVCxDQUFjLGdCQUFkLEVBQWdDLElBQUl6QixjQUFKLENBQW1Cb0MsT0FBbkIsRUFBNEJ0SixZQUE1QixDQUFoQztFQUNILENBTEQ7RUFPQSxPQUFPLElBQVA7QUFDSCxDQVREOztBQVdBSSxDQUFDLENBQUNvSixRQUFELENBQUQsQ0FBWW5DLEtBQVosQ0FBa0IsWUFBQTtFQUNkLElBQU1nQyxjQUFjLEdBQW1CakosQ0FBQyxDQUFDLGtCQUFELENBQUQsQ0FBc0JpSixjQUF0QixHQUF1Q1YsSUFBdkMsQ0FBNEMsZ0JBQTVDLENBQXZDO0FBQ0gsQ0FGRCIsImZpbGUiOiJvcmNoYXJkLndvcmtmbG93cy12aWV3ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cclxuXHJcbmFic3RyYWN0IGNsYXNzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUgbWluQ2FudmFzSGVpZ2h0OiBudW1iZXIgPSA0MDA7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHlFbGVtZW50cyA9ICgpOiBKUXVlcnkgPT4ge1xyXG4gICAgICAgIHJldHVybiAkKHRoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcclxuICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxyXG4gICAgICAgICAgICBFbmRwb2ludFN0eWxlczogW3sgZmlsbFN0eWxlOiAnIzIyNTU4OCcgfV0sXHJcbiAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxyXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcclxuICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHsgd2lkdGg6IDEyLCBsZW5ndGg6IDEyLCBsb2NhdGlvbjogLTUgfV0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbm5lY3RvclpJbmRleDogNVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ganNQbHVtYi5nZXRJbnN0YW5jZSh7XHJcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICBbJ0Fycm93Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDExLFxyXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aDogMTFcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcclxuICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbnRhaW5lcjogdGhpcy5jb250YWluZXJcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEVuZHBvaW50Q29sb3IgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSwgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUpOiBFbmRwb2ludE9wdGlvbnMgPT4ge1xyXG4gICAgICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgY29uc3QgcGFpbnRDb2xvciA9IHRoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxyXG4gICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgcGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxyXG4gICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcclxuICAgICAgICAgICAgICAgIHJhZGl1czogNyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzU291cmNlOiB0cnVlLFxyXG4gICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcclxuICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXHJcbiAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3JyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcclxuICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxyXG4gICAgICAgICAgICB1dWlkOiBgJHthY3Rpdml0eS5pZH0tJHtvdXRjb21lLm5hbWV9YCxcclxuICAgICAgICAgICAgcGFyYW1ldGVyczoge1xyXG4gICAgICAgICAgICAgICAgb3V0Y29tZTogb3V0Y29tZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkOiBzdHJpbmcsIGFjdGl2aXRpZXM6IEFycmF5PFdvcmtmbG93cy5BY3Rpdml0eT4gPSBudWxsKTogV29ya2Zsb3dzLkFjdGl2aXR5IHtcclxuICAgICAgICBpZiAoIWFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAkLmdyZXAoYWN0aXZpdGllcywgKHg6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4geC5pZCA9PT0gaWQpWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDb25uZWN0aW9ucyA9IChwbHVtYmVyOiBqc1BsdW1iSW5zdGFuY2UpID0+IHtcclxuICAgICAgICB2YXIgd29ya2Zsb3dJZDogbnVtYmVyID0gdGhpcy53b3JrZmxvd1R5cGUuaWQ7XHJcblxyXG4gICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cclxuICAgICAgICBmb3IgKGxldCB0cmFuc2l0aW9uTW9kZWwgb2YgdGhpcy53b3JrZmxvd1R5cGUudHJhbnNpdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRVdWlkOiBzdHJpbmcgPSBgJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlQWN0aXZpdHlJZH0tJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlT3V0Y29tZU5hbWV9YDtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xyXG4gICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkVsZW1lbnRJZDogc3RyaW5nID0gYGFjdGl2aXR5LSR7d29ya2Zsb3dJZH0tJHt0cmFuc2l0aW9uTW9kZWwuZGVzdGluYXRpb25BY3Rpdml0eUlkfWA7XHJcblxyXG4gICAgICAgICAgICBwbHVtYmVyLmNvbm5lY3Qoe1xyXG4gICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcclxuICAgICAgICAgICAgICAgIHRhcmdldDogZGVzdGluYXRpb25FbGVtZW50SWRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDYW52YXNIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJGNvbnRhaW5lciA9ICQodGhpcy5jb250YWluZXIpO1xyXG5cclxuICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXHJcbiAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRFbGVtZW50VG9wID0gMDtcclxuICAgICAgICBsZXQgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgYWN0aXZpdHlFbGVtZW50IG9mICRhY3Rpdml0eUVsZW1lbnRzLnRvQXJyYXkoKSkge1xyXG4gICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3AgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRvcCA+IGN1cnJlbnRFbGVtZW50VG9wKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcDtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9ICRhY3Rpdml0eUVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcclxuICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XHJcbiAgICAgICAgY29uc3Qgc3RyZXRjaFZhbHVlID0gMTAwO1xyXG5cclxuICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcclxuICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcclxuICAgIH07XHJcbn1cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1jYW52YXMudHMnIC8+XHJcblxyXG5jbGFzcyBXb3JrZmxvd1ZpZXdlciBleHRlbmRzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUganNQbHVtYkluc3RhbmNlOiBqc1BsdW1iSW5zdGFuY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcclxuICAgICAgICBzdXBlcihjb250YWluZXIsIHdvcmtmbG93VHlwZSk7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGpzUGx1bWIucmVhZHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBqc1BsdW1iLmltcG9ydERlZmF1bHRzKHRoaXMuZ2V0RGVmYXVsdHMoKSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwbHVtYmVyID0gdGhpcy5jcmVhdGVKc1BsdW1iSW5zdGFuY2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgbmV3IGNvbm5lY3Rpb25zLlxyXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb246IENvbm5lY3Rpb24gPSBjb25uSW5mby5jb25uZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUgPSBjb25uZWN0aW9uLmdldFBhcmFtZXRlcnMoKS5vdXRjb21lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsOiBhbnkgPSBjb25uZWN0aW9uLmdldE92ZXJsYXkoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgYWN0aXZpdHlFbGVtZW50cyA9IHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyZUVxdWFsT3V0Y29tZXMgPSBmdW5jdGlvbiAob3V0Y29tZXMxOiBXb3JrZmxvd3MuT3V0Y29tZVtdLCBvdXRjb21lczI6IFdvcmtmbG93cy5PdXRjb21lW10pOiBib29sZWFuIHtcclxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lczEubGVuZ3RoICE9IG91dGNvbWVzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvdXRjb21lczEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lMSA9IG91dGNvbWVzMVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lMiA9IG91dGNvbWVzMltpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dGNvbWUxLm5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUgfHwgb3V0Y29tZTEuZGlzcGxheU5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU3VzcGVuZCBkcmF3aW5nIGFuZCBpbml0aWFsaXplLlxyXG4gICAgICAgICAgICBwbHVtYmVyLmJhdGNoKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLmVhY2goKGluZGV4LCBhY3Rpdml0eUVsZW1lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHkgPSB0aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIGFjdGl2aXR5IGFzIGEgdGFyZ2V0LlxyXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogJ2hvdmVyJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBvdXRjb21lIG9mIGFjdGl2aXR5Lm91dGNvbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IHRoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zKGFjdGl2aXR5LCBvdXRjb21lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMgPSB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNYWtlIGFsbCBhY3Rpdml0eSBlbGVtZW50cyB2aXNpYmxlLlxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmpzUGx1bWJJbnN0YW5jZSA9IHBsdW1iZXI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEVuZHBvaW50Q29sb3IgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nID8gJyM3YWIwMmMnIDogYWN0aXZpdHkuaXNFdmVudCA/ICcjM2E4YWNkJyA6ICcjN2FiMDJjJztcclxuICAgIH1cclxufVxyXG5cclxuJC5mbi53b3JrZmxvd1ZpZXdlciA9IGZ1bmN0aW9uICh0aGlzOiBKUXVlcnkpOiBKUXVlcnkge1xyXG4gICAgdGhpcy5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LXR5cGUnKTtcclxuXHJcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3dWaWV3ZXInLCBuZXcgV29ya2Zsb3dWaWV3ZXIoZWxlbWVudCwgd29ya2Zsb3dUeXBlKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IHdvcmtmbG93Vmlld2VyOiBXb3JrZmxvd1ZpZXdlciA9ICQoJy53b3JrZmxvdy1jYW52YXMnKS53b3JrZmxvd1ZpZXdlcigpLmRhdGEoJ3dvcmtmbG93Vmlld2VyJyk7XHJcbn0pO1xyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LWNhbnZhcy50cycgLz5cbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG52YXIgV29ya2Zsb3dWaWV3ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdvcmtmbG93Vmlld2VyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFdvcmtmbG93Vmlld2VyKGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIF90aGlzLndvcmtmbG93VHlwZSA9IHdvcmtmbG93VHlwZTtcbiAgICAgICAgX3RoaXMuZ2V0RW5kcG9pbnRDb2xvciA9IGZ1bmN0aW9uIChhY3Rpdml0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc2VsZiA9IF90aGlzO1xuICAgICAgICBqc1BsdW1iLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHMoX3RoaXMuZ2V0RGVmYXVsdHMoKSk7XG4gICAgICAgICAgICB2YXIgcGx1bWJlciA9IF90aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBjb25uZWN0aW9uLmdldFBhcmFtZXRlcnMoKS5vdXRjb21lO1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudHMgPSBfdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczEsIG91dGNvbWVzMikge1xuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lczEubGVuZ3RoICE9IG91dGNvbWVzMi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMiA9IG91dGNvbWVzMltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dGNvbWUxLm5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUgfHwgb3V0Y29tZTEuZGlzcGxheU5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXG4gICAgICAgICAgICBwbHVtYmVyLmJhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgd29ya2Zsb3dJZCA9IF90aGlzLndvcmtmbG93VHlwZS5pZDtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBhY3Rpdml0eUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHkgPSBfdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyBhIHRhcmdldC5cbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5tYWtlVGFyZ2V0KGFjdGl2aXR5RWxlbWVudCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogJ2hvdmVyJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogWydCbGFuaycsIHsgcmFkaXVzOiA4IH1dXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IGFjdGl2aXR5Lm91dGNvbWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnRPcHRpb25zID0gX3RoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zKGFjdGl2aXR5LCBvdXRjb21lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuYWRkRW5kcG9pbnQoYWN0aXZpdHlFbGVtZW50LCB7IGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbGFiZWw6IG91dGNvbWUuZGlzcGxheU5hbWUsIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCcgfV1dIH0sIHNvdXJjZUVuZHBvaW50T3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ29ubmVjdGlvbnMocGx1bWJlcik7XG4gICAgICAgICAgICAgICAgLy8gUmUtcXVlcnkgdGhlIGFjdGl2aXR5IGVsZW1lbnRzLlxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMgPSBfdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhbGwgYWN0aXZpdHkgZWxlbWVudHMgdmlzaWJsZS5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnNob3coKTtcbiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93Vmlld2VyO1xufShXb3JrZmxvd0NhbnZhcykpO1xuJC5mbi53b3JrZmxvd1ZpZXdlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy10eXBlJyk7XG4gICAgICAgICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93Vmlld2VyJywgbmV3IFdvcmtmbG93Vmlld2VyKGVsZW1lbnQsIHdvcmtmbG93VHlwZSkpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xufTtcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgd29ya2Zsb3dWaWV3ZXIgPSAkKCcud29ya2Zsb3ctY2FudmFzJykud29ya2Zsb3dWaWV3ZXIoKS5kYXRhKCd3b3JrZmxvd1ZpZXdlcicpO1xufSk7XG4iXX0=
